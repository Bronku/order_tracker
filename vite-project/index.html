<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="#">
    <title>Document</title>
    <script type = "module" defer src="/src/main.ts"></script>
    <script type = "module" defer src="/src/database.ts"></script>
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
</head>
<body x-data = "main">
    <div id = "app">
        <div class="app-layout">
            <aside class = "app-sidebar">
                <nav class = "side-navigation">
                    <template x-for = "item in routes">
                        <a class = "nav-button" x-bind:class="item.path == page && 'selected-nav-button'" x-bind:title="item.name" x-on:click.prevent = "page = item.path">
                            <box-icon x-bind:name="item.icon"></box-icon>
                        </a>
                    </template>
                </nav>
            </aside>
            <div class="app-body">
                <template x-if = "page === 'view'">
                    <main>
                        <header>
                            <h1>Aktualne zamówienia</h1>
                        </header>
                        <div class="content">
                            <div class="scroller_wrapper">
                                <table style = "table-layout: fixed;width: 100%;">
                                        <thead>
                                            <tr>
                                                <th></th>
                                                <th><span>Imię</span></th>
                                                <th><span>Nazwisko</span></th>
                                                <th><span>Dostawa</span></th>
                                                <th><span>Numer kontaktowy</span></th>
                                                <th><span>Do zapłaty</span></th>
                                                <th x-data = "{show: false, date:''}" x-on:click.outside="show=false">
                                                    <div x-on:click="show = !show">
                                                        <span x-show="!show  && date == ''">Data odbioru</span>
                                                        <span x-show="!show  && date != ''" x-text="date"></span>
                                                    </div>
                                                    <input x-show = "show" type = "date" x-model = "date" x-on:change="filter_orders(date)">
                                                </th>
                                                <th><span>Status</span></th>
                                                <th><span>Dodatkowe informacje</span></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for = "order in orders" :key = "order.id">
                                                    <tr style = "vertical-align:top" :title = "order.id">
                                                        <td  x-data = "{expanded : false}"  >
                                                            <a x-on:click.prevent = "expanded = !expanded">
                                                                <box-icon x-bind:class = "expanded ? 'arrow_open' : 'arrow_close'" name='chevron-down'></box-icon>
                                                            </a>
                                                            <div x-show="expanded">
                                                                <template x-for = "item in order.contents" :key="item.cake.id">
                                                                    <li>
                                                                        <span x-text = "item.cake.name"></span>
                                                                        <span x-text = "item.cake.price"></span>
                                                                        <span x-text = "item.quantity"></span>
                                                                    </li>
                                                                </template>
                                                            </div>
                                                        </td>
                                                        <td x-text = "order.surname"></td>
                                                        <td x-text = "order.delivery === 'dostawa' ? order.address : order.delivery"></td>
                                                        <td x-text = "order.phone"></td>
                                                        <td x-text = "order.price"></td>
                                                        <td x-text = "order.date"></td>
                                                        <td x-text = "order.status"></td>
                                                        <td x-text = "order.additional_info"></td>
                                                        <td x-data = "{show: false}">
                                                            <button x-on:click.prevent = "show = !show">...</button>
                                                            <div x-show="show">
                                                                <button x-on:click.prevent = "edit_order(order)">edit</button>
                                                                <button x-on:click.prevent = "delete_order(order)">delete</button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                            </template>
                                        </tbody>
                                </table>
                            </div>
                        </div>
                    </main>
                </template>
                <template x-if = "page === 'summary'">
                    <main>
                        <header>
                            <h1>Podsumowanie</h1>
                        </header>
                        <div class="content">
                            <div class="scroller_wrapper">
                                <table>
                                    <thead>
                                        <tr>
                                            <th><span>Ciasto</span></th>
                                            <th><span>Zamówiona Ilość</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for = "cake in cakes" :key = "cake.cake.id">
                                            <tr :title = "cake.cake.id">
                                                <td x-text = "cake.cake.name"></td>
                                                <td x-text = "cake.sum"></td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>
                </template>
                <template x-if = "page === 'edit'">
                    <main>
                        <h1>Edit</h1>
                        <form x-effect = "update_price(current_order)">
                            <div>
                                <label for="name">Name</label>
                                <input type="text" name="name" id="name" x-model = "current_order.name">
                            </div>
                        
                            <div>
                                <label for="surname">Surname</label>
                                <input type="text" name="surname" id="surname" x-model = "current_order.surname">
                            </div>
    
                            <div>
                                <label for="delivery">Delivery</label>
                                <select name="delivery" id="delivery" x-model = "current_order.delivery">
                                    <option value="kartuzy">Kartuzy</option>
                                    <option value="somonino">Somonino</option>
                                    <option value="dostawa">Dostawa</option>
                                </select>
                            </div>
                        
                            <div x-show = "current_order.delivery === 'dostawa'">
                                <label for="address">Address</label>
                                <input type="text" name="address" id="address" x-model = "current_order.address">
                            </div>
                        
                            <div>
                                <label for="phone">Phone</label>
                                <input type="text" name="phone" id="phone" x-model = "current_order.phone">
                            </div>
                        
                            <div>
                                <label for = "advance" >Advance</label>
                                <input type = "text" name = "advance" id = "advance" x-model = "current_order.advance">
                            </div>
                        
                            <div>
                                <label for = "status" >Status</label>
                                <select name = "status" id = "status" x-model = "current_order.status">
                                    <option value = "zamówione" >Zamówione</option>
                                    <option value = "w trakcie" >W trakcie</option>
                                    <option value = "gotowe" >Gotowe</option>
                                    <option value = "odebrane" >Odebrane</option>
                                </select>
                            </div>
                        
                            <div>
                                <label for = "date" >Date</label>
                                <input type = "date" name = "date" id = "date" x-model = "current_order.date">
                            </div>
                        
                            <div>
                                <label for = "additional_info" >Additional info</label>
                                <input type = "text" name = "additional_info" id = "additional_info" x-model = "current_order.additional_info">
                            </div>
                        
                            <div>
                                <template x-for ="item in current_order.contents" :key="item.cake.id">
                                    <li>
                                        <label :for = "$id('quantity', item.cake.id)">
                                            <span x-text = "item.cake.name"></span>
                                            <span> - </span>
                                            <span x-text = "item.cake.price"></span>
                                            <span>zł, total: </span>
                                            <span x-text = "item.cake.price * item.quantity"></span>
                                            <span>zł</span>
                                        </label>
                                        <input type = "text" name = "quantity" :id = "$id('quantity', item.cake.id)" x-model = "item.quantity">
                                        <button x-on:click.prevent = "remove_cake(item.cake)">remove</button>
                                    </li>
                                </template>
                            </div>
    
                            <div x-data = "{show : false}">
                                <button x-on:click.prevent = "show = !show">expand available cakes</button>
                                <div x-show="show">
                                    <template x-for = "cake in cakes" :key = "cake.cake.id">
                                        <li>
                                            <button x-on:click.prevent = "add_cake(cake.cake)">add</button>
                                            <span x-text="cake.cake.name"></span>
                                            <span> - </span>
                                            <span x-text="cake.cake.price"></span>
                                            <span>zł</span>
                                        </li>
                                    </template>
                                </div>
                            </div>
                        
                            <div>
                                <span>Total price: </span>
                                <span x-text = "current_order.price"></span>
                                <span>zł</span>
                            </div>
                        
                            <button x-on:click.prevent = "save_order()">save</button>
                            <button x-on:click.prevent = "clear_form()">clear</button>
                        </form>
                    </main>
                </template>

            </div>
        </div>
    </div>
</html>